<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>Spring Cloud Reference Doc&lbrack;3&period;4&period;0&rbrack;</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h1 id="spring-cloud-reference-doc340">Spring Cloud Reference Doc[3.4.0]</h1>
<pre><code>- This documentation is created for reference from the Spring cloud POC we have developed in this turotial
</code></pre>
<hr>
<h2 id="00-port-standardization">00. Port standardization</h2>
<ul>
<li>Below are be the port specific to each service we'l be developing in this tutorial.</li>
</ul>
<table>
<thead>
<tr>
<th><strong>Application</strong></th>
<th><strong>Port</strong></th>
<th><strong>Info</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Limits Microservice</td>
<td><em>8080, 8081, etc.</em></td>
<td>~</td>
</tr>
<tr>
<td>Spring Cloud Config Server</td>
<td><em>8888</em></td>
<td>Port 8888 is default port for config srver as per spring docs.</td>
</tr>
<tr>
<td>Currency Exchange Microservice</td>
<td><em>8000, 8001, 8002, etc.</em></td>
<td>~</td>
</tr>
<tr>
<td>Currency Conversion Microservice</td>
<td><em>8100, 8101, 8102, etc.</em></td>
<td>~</td>
</tr>
<tr>
<td>Netflix Eureka Naming Server</td>
<td><em>8761</em></td>
<td>~</td>
</tr>
<tr>
<td>API Gateway</td>
<td><em>8765</em></td>
<td>~</td>
</tr>
<tr>
<td>Zipkin Distributed Tracing Server</td>
<td><em>9411</em></td>
<td>~</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="01-develop-cloud-config-server">01. Develop cloud config server</h2>
<h3 id="project-ref-b2-sboot-cloud-config-server">Project ref: <em>b2-sboot-cloud-config-server</em></h3>
<ul>
<li>
<p><strong><ins>Purpose / Feature</ins></strong></p>
<ul>
<li>Spring Cloud Config provides server-side and client-side support for externalized configuration in a distributed system.</li>
<li>With the Config Server, you have a central place to manage external properties for applications across all environments.</li>
</ul>
</li>
<li>
<p><strong><ins>Maven / External dependency</ins></strong></p>
<ul>
<li>Add spring validation dependency.<pre><code class="language-xml">	<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-config-server<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong><ins>Code changes</ins></strong></p>
<ul>
<li>B2SbootCloudConfigServerApplication.java main app.
<ul>
<li>imports
<ul>
<li><code>import org.springframework.cloud.config.server.EnableConfigServer;</code></li>
<li>Config server is enabled by adding annotation on main app.<pre><code class="language-java">	<span class="hljs-comment">/* Enable config server. */</span>
	<span class="hljs-meta">@EnableConfigServer</span> 
	<span class="hljs-meta">@SpringBootApplication</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">B2SbootCloudConfigServerApplication</span> {

		<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
			SpringApplication.run(B2SbootCloudConfigServerApplication.class, args);
		}

	}
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>application.properties</strong><pre><code class="language-properties">	<span class="hljs-attr">spring.application.name</span>=<span class="hljs-string">b2-sboot-cloud-config-server</span>
<span class="hljs-comment">
	# Server port for config server</span>
	<span class="hljs-attr">server.port</span>=<span class="hljs-string">8888</span>
<span class="hljs-comment">
	# Start: Git repo config</span>
<span class="hljs-comment">
	# Github.com</span>
	<span class="hljs-attr">spring.cloud.config.server.git.uri</span>=<span class="hljs-string">https://github.com/SRVivek1/spring-cloud-config-server-git-repo.git</span>
<span class="hljs-comment">
	# local git</span>
<span class="hljs-comment">	#spring.cloud.config.server.git.uri=file:///home/srvivek/wrkspace/spring-cloud-config-server-git-repo</span>
<span class="hljs-comment">
	# windows</span>
<span class="hljs-comment">	#spring.cloud.config.server.git.uri=file:///c:/wrkspace/spring-cloud-config-server-git-repo</span>
<span class="hljs-comment">
	# End: Git repo config</span>
</code></pre>
</li>
<li><strong>Git repo</strong>
<ul>
<li>In git repo, create propertie file using microervice name - <code>&lt;microservice-name&gt;[-&lt;env&gt;].properties</code> in the base directory.<pre><code class="language-properties">	<span class="hljs-attr">./limits-service-prod.properties</span>
	<span class="hljs-attr">./limits-service-dev.properties</span>
	<span class="hljs-attr">./limits-service.properties</span>
	<span class="hljs-attr">./limits-service-qa.properties</span>
	<span class="hljs-attr">./currency-exchange-service.properties</span>

</code></pre>
</li>
<li>Content<pre><code class="language-properties">	<span class="hljs-attr">limits-service.properties</span>:<span class="hljs-string">limits-service.minimum=8</span>
	<span class="hljs-attr">limits-service.properties</span>:<span class="hljs-string">limits-service.maximum=888</span>
	<span class="hljs-attr">limits-service-dev.properties</span>:<span class="hljs-string">limits-service.minimum=1</span>
	<span class="hljs-attr">limits-service-dev.properties</span>:<span class="hljs-string">limits-service.maximum=111</span>
	<span class="hljs-attr">limits-service-qa.properties</span>:<span class="hljs-string">limits-service.minimum=3</span>
	<span class="hljs-attr">limits-service-qa.properties</span>:<span class="hljs-string">limits-service.maximum=333</span>
	<span class="hljs-attr">limits-service-prod.properties</span>:<span class="hljs-string">limits-service.minimum=6</span>
	<span class="hljs-attr">limits-service-prod.properties</span>:<span class="hljs-string">limits-service.maximum=666</span>
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong><ins>Notes:</ins></strong></p>
<ul>
<li><code>@EnableConfigServer</code> annotation:
<ul>
<li>Help enable and configure Config. Server artifacts.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong><ins>References:</ins></strong></p>
<ul>
<li><a href="https://docs.spring.io/spring-cloud-config/docs/current/reference/html/">https://docs.spring.io/spring-cloud-config/docs/current/reference/html/</a></li>
<li><a href="https://docs.spring.io/spring-cloud-config/docs/current/reference/html/#_spring_cloud_config_server">https://docs.spring.io/spring-cloud-config/docs/current/reference/html/#_spring_cloud_config_server</a></li>
</ul>
</li>
</ul>
<hr>
<h2 id="02-developenable-cloud-config-client">02. Develop/Enable cloud config client</h2>
<h3 id="project-ref-b1-limits-service">Project ref: <em>b1-limits-service</em></h3>
<ul>
<li>
<p><strong><ins>Purpose / Feature</ins></strong></p>
<ul>
<li>A Spring Boot application can take immediate advantage of the Spring Config Server (or other external property sources provided by the application developer).</li>
<li>It also picks up some additional useful features related to Environment change events.</li>
<li>**Config client is enabled by default.</li>
</ul>
</li>
<li>
<p><strong><ins>Maven / External dependency</ins></strong></p>
<ul>
<li>Add spring validation dependency.<pre><code class="language-xml">	<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong><ins>Code changes</ins></strong></p>
<ul>
<li>Create a <code>configurationProperties</code> class.
<ul>
<li>imports
<ul>
<li><code>import org.springframework.boot.context.properties.ConfigurationProperties;</code></li>
</ul>
</li>
<li>Annotate the class for injecting properties.</li>
</ul>
<pre><code class="language-java">	<span class="hljs-meta">@ConfigurationProperties(prefix = &quot;limits-service&quot;)</span>
	<span class="hljs-meta">@Component</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LimitsServiceConfiguration</span> {

		<span class="hljs-comment">// it will match to property named - limits-service.minimum</span>
		<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> minimum;

		<span class="hljs-comment">// it will match to property named - limits-service.maximum</span>
		<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> maximum;

		<span class="hljs-comment">// constructors, getter-setters.</span>
	}
</code></pre>
</li>
<li>Controller / Service class
<ul>
<li>imports
<ul>
<li><code>None specific to config client.</code></li>
</ul>
</li>
<li>Add validation in the properties of the bean.</li>
</ul>
<pre><code class="language-java">	<span class="hljs-meta">@RestController</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LimitsServiceController</span> {

		<span class="hljs-meta">@Autowired</span>
		LimitsServiceConfiguration limitsServiceConfiguration;

		<span class="hljs-comment">/**
		* Read property value from application.properties.
		* <span class="hljs-doctag">@return</span>
		*/</span>
		<span class="hljs-meta">@GetMapping(&quot;/limits&quot;)</span>
		<span class="hljs-keyword">public</span> Limits <span class="hljs-title function_">retrieveLimits</span><span class="hljs-params">()</span> {
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Limits</span>(limitsServiceConfiguration.getMinimum(), limitsServiceConfiguration.getMaximum());
		}
	}
</code></pre>
</li>
<li>Limits Java bean to represent the data in one unit<pre><code class="language-java">	<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Limits</span> {

		<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> minimum;
		<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> maximum;

		<span class="hljs-keyword">public</span> <span class="hljs-title function_">Limits</span><span class="hljs-params">(<span class="hljs-type">int</span> minimum, <span class="hljs-type">int</span> maximum)</span> {
			<span class="hljs-built_in">super</span>();
			<span class="hljs-built_in">this</span>.minimum = minimum;
			<span class="hljs-built_in">this</span>.maximum = maximum;
		}

		<span class="hljs-comment">//getter-setters &amp; other methods</span>
	}
</code></pre>
</li>
<li>application.properties<pre><code class="language-properties"><span class="hljs-comment">	#spring.profiles.active=dev,qa</span>
<span class="hljs-comment">
	# Start: Cloud config client</span>
<span class="hljs-comment">
	# Mention profile for default use.</span>
<span class="hljs-comment">	# spring.cloud.config.profile=default</span>
	<span class="hljs-attr">spring.cloud.config.profile</span>=<span class="hljs-string">dev</span>
<span class="hljs-comment">	#spring.cloud.config.profile=qa</span>
<span class="hljs-comment">
	# Provide name for this services, used to match for available properties file.</span>
<span class="hljs-comment">	# for dev profile it will check the file name - limits-service-dev.properties in config. server.</span>
	<span class="hljs-attr">spring.cloud.config.name</span>=<span class="hljs-string">limits-service</span>
<span class="hljs-comment">
	# this part is mandatory if config client dependency is added in POM to start the app.</span>
<span class="hljs-comment">	#spring.config.import=optional:configserver:</span>
<span class="hljs-comment">
	# 8888 - it&#x27;s default port for config server</span>
	<span class="hljs-attr">spring.config.import</span>=<span class="hljs-string">optional:configserver:http://localhost:8888/</span>
<span class="hljs-comment">
	# To enable/disable remote configuration, by default is enabled </span>
<span class="hljs-comment">	#spring.cloud.config.enabled=false </span>
<span class="hljs-comment">
	# End: Cloud config client</span>
<span class="hljs-comment">

	# Start: local service configuration</span>
	<span class="hljs-attr">limits-service.minimum</span>=<span class="hljs-string">20</span>
	<span class="hljs-attr">limits-service.maximum</span>=<span class="hljs-string">21</span>

	<span class="hljs-attr">app-config.minimum</span>=<span class="hljs-string">10</span>
	<span class="hljs-attr">app-config.maximum</span>=<span class="hljs-string">11</span>
<span class="hljs-comment">	# End: local service configuration</span>

</code></pre>
</li>
</ul>
</li>
<li>
<p><strong><ins>Notes:</ins></strong></p>
<ul>
<li>Spring Boot 2.4 introduced a new way to import configuration data via the <code>spring.config.import</code> property.</li>
<li>This is now the default way to bind to Config Server.</li>
<li>To optionally connect to config server set the following in <code>application.properties</code>:<pre><code class="language-properties">	<span class="hljs-attr">spring.config.import</span>=<span class="hljs-string">optional:configserver:</span>
</code></pre>
</li>
<li>This will connect to the Config Server at the default location of <a href="http://localhost:8888">http://localhost:8888</a>.</li>
<li>Removing the optional: prefix will cause the Config Client to fail if it is unable to connect to Config Server.</li>
<li>To change the location of Config Server either set <code>spring.cloud.config.uri</code> or add the url to the <code>spring.config.import</code> statement such as, <code>spring.config.import=optional:configserver:http://myhost:8888</code>.</li>
<li>The location in the import property has precedence over the uri property.</li>
<li>Spring Boot Config Data resolves configuration in a two step process.
<ul>
<li>First it loads all configuration using the default profile. This allows Spring Boot to gather all configuration which may activate any additional profiles.</li>
<li>After it has gathered all activated profiles it will load any additional configuration for the active profiles.</li>
<li>Due to this you may see multiple requests being made to the Spring Cloud Config Server to fetch configuration.</li>
<li>This is normal and is a side effect of how Spring Boot loads configuration when using <code>spring.config.import</code>.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong><ins>References:</ins></strong></p>
<ul>
<li><a href="https://docs.spring.io/spring-cloud-config/docs/current/reference/html/">https://docs.spring.io/spring-cloud-config/docs/current/reference/html/</a></li>
<li><a href="https://docs.spring.io/spring-cloud-config/docs/current/reference/html/#_spring_cloud_config_client">https://docs.spring.io/spring-cloud-config/docs/current/reference/html/#_spring_cloud_config_client</a></li>
</ul>
</li>
</ul>
<hr>
<h2 id="3-resttemplate-connect-to-other-mircoservice">3. RestTemplate: Connect to other mircoservice</h2>
<h3 id="project-ref-b4-currency-conversion-service">Project ref: <em>b4-currency-conversion-service</em></h3>
<ul>
<li><strong><ins>Purpose / Feature</ins></strong>
<ul>
<li>A synchronous client to perform HTTP requests, exposing a simple, template method API over underlying HTTP client libraries such as the JDK HttpURLConnection, Apache HttpComponents, and others.</li>
<li>RestTemplate offers templates for common scenarios by HTTP method, in addition to the generalized exchange and execute methods that support less frequent cases.</li>
<li>RestTemplate is typically used as a shared component.
<ul>
<li>However, its configuration does not support concurrent modification, and as such its configuration is typically prepared on startup.</li>
</ul>
</li>
<li>If necessary, you can create multiple, differently configured RestTemplate instances on startup.
<ul>
<li>Such instances may use the same underlying ClientHttpRequestFactory if they need to share HTTP client resources.</li>
</ul>
</li>
<li>RestTemplate and RestClient share the same infrastructure (i.e. request factories, request interceptors and initializers, message converters, etc.), so any improvements made therein are shared as well.
<ul>
<li>However, RestClient is the focus for new higher-level features.</li>
</ul>
</li>
</ul>
</li>
<li><strong><ins>Maven / External dependency</ins></strong>
<ul>
<li>Required dependency.<pre><code class="language-xml">	<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
</li>
</ul>
</li>
<li><strong><ins>Code changes</ins></strong>
<ul>
<li>imports
<ul>
<li><code>import org.springframework.web.client.RestTemplate;</code></li>
</ul>
</li>
<li>Annotate the method parameter for validation.<pre><code class="language-java">			<span class="hljs-meta">@GetMapping(&quot;/currency-conversion/from/{from}/to/{to}/quantity/{quantity}&quot;)</span>
			<span class="hljs-keyword">public</span> CurrencyConversion <span class="hljs-title function_">calculateCurrencyConversion</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String from, <span class="hljs-meta">@PathVariable</span> String to,
					<span class="hljs-meta">@PathVariable</span> BigDecimal quantity)</span> {

				logger.info(<span class="hljs-string">&quot;Executing CurrencyConversionController.calculateCurrencyConversion(..) API.&quot;</span>);

				<span class="hljs-comment">// Standardize</span>
				from = from.toUpperCase();
				to = to.toUpperCase();

				<span class="hljs-keyword">final</span> Map&lt;String, String&gt; uriVariables = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
				uriVariables.put(<span class="hljs-string">&quot;from&quot;</span>, from);
				uriVariables.put(<span class="hljs-string">&quot;to&quot;</span>, to);
				
				<span class="hljs-comment">// Send request to Currency exchange micro-service</span>
				<span class="hljs-keyword">final</span> ResponseEntity&lt;CurrencyConversion&gt; response = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>().getForEntity(
						<span class="hljs-string">&quot;http://localhost:8000/jpa/currency-exchange/from/{from}/to/{to}&quot;</span>, CurrencyConversion.class,
						uriVariables);
				<span class="hljs-keyword">final</span> <span class="hljs-type">CurrencyConversion</span> <span class="hljs-variable">currencyConversionExchange</span> <span class="hljs-operator">=</span> response.getBody();

				logger.debug(<span class="hljs-string">&quot;Response from currency-exchange : {}&quot;</span>, currencyConversionExchange);

				<span class="hljs-keyword">final</span> <span class="hljs-type">CurrencyConversion</span> <span class="hljs-variable">currencyConversion</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CurrencyConversion</span>(currencyConversionExchange.getId(), from, to, quantity,
						currencyConversionExchange.getConversionMultiples(),
						quantity.multiply(currencyConversionExchange.getConversionMultiples()), currencyConversionExchange.getEnvironment());
				
				logger.debug(<span class="hljs-string">&quot;Response returned : {}&quot;</span>, currencyConversionExchange);
				
				<span class="hljs-keyword">return</span> currencyConversion;
			}
</code></pre>
</li>
<li>imports
<ul>
<li><code>import java.math.BigDecimal;</code></li>
</ul>
</li>
<li>Annotate the method parameter for validation.<pre><code class="language-java">	<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CurrencyConversion</span> {

		<span class="hljs-keyword">private</span> Long id;
		<span class="hljs-keyword">private</span> String from;
		<span class="hljs-keyword">private</span> String to;
		<span class="hljs-keyword">private</span> BigDecimal conversionMultiples;
		<span class="hljs-keyword">private</span> BigDecimal quantity;
		<span class="hljs-keyword">private</span> BigDecimal totalCalculatedAmount;
		<span class="hljs-keyword">private</span> String environment;

		<span class="hljs-comment">// contructors, setter-getters</span>
	}
</code></pre>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>Note: When using <code>RestTemplate</code> we have to write boiler plate code to call rest service. To overcome this, we can use another spring dependency <code>spring-cloud-openfeign</code>.</p>
</blockquote>
<ul>
<li><strong><ins>References:</ins></strong>
<ul>
<li><a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html">https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html</a></li>
</ul>
</li>
</ul>
<hr>
<h2 id="4-openfeign-client-connect-to-other-mircoservice">4. OpenFeign client: Connect to other mircoservice</h2>
<h3 id="project-ref-b5-currency-conversion-service-openfeign">Project ref: <em>b5-currency-conversion-service-openfeign</em></h3>
<ul>
<li>
<p><strong><ins>Purpose / Feature</ins></strong></p>
<ul>
<li>Easy way to make rest service calls.</li>
<li>Removes bioler plate code need to be written while using <code>RestTemplate</code> to invoke a rest service.</li>
</ul>
</li>
<li>
<p><strong><ins>Maven / External dependency</ins></strong></p>
<ul>
<li>Required dependency.<pre><code class="language-xml">	<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

</code></pre>
</li>
</ul>
</li>
<li>
<p><strong><ins>Code changes</ins></strong></p>
<ul>
<li>
<p>Application: Enable feign clients using <em><strong>@EnableFeignClients</strong></em>.</p>
<ul>
<li>Scans for interfaces that declare they are feign clients <code>(via org.springframework.cloud.openfeign.FeignClient @FeignClient)</code>.</li>
<li>Configures component scanning directives for use with <code>org.springframework.context.annotation.Configuration @Configuration</code> classes.</li>
<li>imports
<ul>
<li><code>import org.springframework.cloud.openfeign.EnableFeignClients;</code></li>
</ul>
</li>
<li>Annotate the SpringBoot application to enable feign clients.</li>
</ul>
<pre><code class="language-java">	<span class="hljs-meta">@EnableFeignClients</span>  <span class="hljs-comment">// Enables feign clients in application</span>
	<span class="hljs-meta">@SpringBootApplication</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">B4CurrencyConversionServiceApplication</span> {

		<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
			SpringApplication.run(B4CurrencyConversionServiceApplication.class, args);
		}
	}
</code></pre>
</li>
<li>
<p>Response java bean <em><strong>CurrencyConversion.java</strong></em>.</p>
<ul>
<li>This class must have all the properties expecting from <code>currency-exchange</code> service, to support auto population of response data.</li>
<li>imports
<ul>
<li><code>import java.math.BigDecimal;</code></li>
</ul>
</li>
<li>Annotate the SpringBoot application to enable feign clients.</li>
</ul>
<pre><code class="language-java">	<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CurrencyConversion</span> {

		<span class="hljs-keyword">private</span> Long id;
		<span class="hljs-keyword">private</span> String from;
		<span class="hljs-keyword">private</span> String to;
		<span class="hljs-keyword">private</span> BigDecimal conversionMultiples;
		<span class="hljs-keyword">private</span> BigDecimal quantity;
		<span class="hljs-keyword">private</span> BigDecimal totalCalculatedAmount;
		<span class="hljs-keyword">private</span> String environment;

		<span class="hljs-comment">// constructors, setter-getters.</span>
	}
</code></pre>
</li>
<li>
<p>Create an feign client interface <em><strong>CurrencyExchangeProxy.java</strong></em></p>
<ul>
<li>imports
<ul>
<li><code>import org.springframework.cloud.openfeign.FeignClient;</code></li>
</ul>
</li>
<li>Add validation in the properties of the bean.</li>
</ul>
<pre><code class="language-java">	<span class="hljs-meta">@FeignClient(name = &quot;b3-currency-exchange-service&quot;, url = &quot;localhost:8000&quot;)</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CurrencyExchangeProxy</span> {

		<span class="hljs-comment">/**
		* Method as defined in the host service.
		* <span class="hljs-doctag">@param</span> from
		* <span class="hljs-doctag">@param</span> to
		* <span class="hljs-doctag">@return</span>
		*/</span>
		<span class="hljs-meta">@GetMapping(&quot;/jpa/currency-exchange/from/{from}/to/{to}&quot;)</span>
		<span class="hljs-keyword">public</span> CurrencyConversion <span class="hljs-title function_">retrieveExchangeRateFromDatabase</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String from, <span class="hljs-meta">@PathVariable</span> String to)</span>;
	}
</code></pre>
<ul>
<li>Controller/Service to use feign client interface.</li>
<li>imports
<ul>
<li><code>import org.springframework.cloud.openfeign.FeignClient;</code></li>
</ul>
</li>
<li>Add validation in the properties of the bean.</li>
</ul>
<pre><code class="language-java">	<span class="hljs-meta">@RestController</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CurrencyConversionController</span> {

		<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(CurrencyConversionController.class);

		<span class="hljs-meta">@Autowired</span>
		<span class="hljs-keyword">private</span> CurrencyExchangeProxy currencyExchangeProxy;

		<span class="hljs-comment">/**
		* Currency conversion using feign client.
		* <span class="hljs-doctag">@param</span> from
		* <span class="hljs-doctag">@param</span> to
		* <span class="hljs-doctag">@param</span> quantity
		* <span class="hljs-doctag">@return</span>
		*/</span>
		<span class="hljs-meta">@GetMapping(&quot;/currency-conversion-feign/from/{from}/to/{to}/quantity/{quantity}&quot;)</span>
		<span class="hljs-keyword">public</span> CurrencyConversion <span class="hljs-title function_">calculateCurrencyConversionFeign</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String from, <span class="hljs-meta">@PathVariable</span> String to,
				<span class="hljs-meta">@PathVariable</span> BigDecimal quantity)</span> {

			logger.info(<span class="hljs-string">&quot;Executing CurrencyConversionController.calculateCurrencyConversionFeign(..) API.&quot;</span>);

			<span class="hljs-comment">// Standardize</span>
			from = from.toUpperCase();
			to = to.toUpperCase();

			<span class="hljs-comment">// Send request to Currency exchange micro-service</span>
			<span class="hljs-keyword">final</span> <span class="hljs-type">CurrencyConversion</span> <span class="hljs-variable">currencyConversionExchange</span> <span class="hljs-operator">=</span> currencyExchangeProxy
					.retrieveExchangeRateFromDatabase(from, to);

			logger.debug(<span class="hljs-string">&quot;Response from currency-exchange : {}&quot;</span>, currencyConversionExchange);

			<span class="hljs-keyword">final</span> <span class="hljs-type">CurrencyConversion</span> <span class="hljs-variable">currencyConversion</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CurrencyConversion</span>(currencyConversionExchange.getId(), from,
					to, quantity, currencyConversionExchange.getConversionMultiples(),
					quantity.multiply(currencyConversionExchange.getConversionMultiples()),
					currencyConversionExchange.getEnvironment());

			logger.debug(<span class="hljs-string">&quot;Response returned : {}&quot;</span>, currencyConversionExchange);

			<span class="hljs-keyword">return</span> currencyConversion;
		}
	}
</code></pre>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>Note: The <code>CurrencyConversion.java</code> bean has all the properties which will be returned from `currency-exchange' service.</p>
</blockquote>
<ul>
<li><strong><ins>References:</ins></strong>
<ul>
<li><a href="https://cloud.spring.io/spring-cloud-netflix/multi/multi_spring-cloud-feign.html">https://cloud.spring.io/spring-cloud-netflix/multi/multi_spring-cloud-feign.html</a></li>
<li><a href="https://docs.spring.io/spring-cloud-openfeign/docs/current/reference/html/">https://docs.spring.io/spring-cloud-openfeign/docs/current/reference/html/</a></li>
</ul>
</li>
</ul>
<hr>
<h2 id="5-service-registry--naming-server--eureka-naming-server">5. Service Registry / Naming server : Eureka naming server</h2>
<h3 id="project-ref-b6-naming-service">Project ref: <em>b6-naming-service</em></h3>
<ul>
<li><strong><ins>Purpose / Feature</ins></strong>
<ul>
<li>It's an application that contains information about all micro services including the name of the service, port, and IP address.</li>
<li>Each microservice has to register itself with the Eureka Server.</li>
<li>Service is available at <code>/</code> context. <a href="http://localhost:8761/">http://localhost:8761/</a></li>
</ul>
</li>
<li><strong><ins>Maven / External dependency</ins></strong>
<ul>
<li>Required dependency.<pre><code class="language-xml">	<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
</li>
</ul>
</li>
<li><strong><ins>Code changes</ins></strong>
<ul>
<li><strong>Controller:</strong> <em>AbcController.java</em>
<ul>
<li>imports
<ul>
<li><code>import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;</code></li>
</ul>
</li>
<li>Annotate the method parameter for validation.</li>
</ul>
<pre><code class="language-java">	<span class="hljs-meta">@EnableEurekaServer</span>
	<span class="hljs-meta">@SpringBootApplication</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">B6NamingServiceApplication</span> {

		<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
			SpringApplication.run(B6NamingServiceApplication.class, args);
		}	
	}
</code></pre>
</li>
<li><strong>Applcation Config:</strong> <em>application.properties</em>
<ul>
<li>Configure Eureka server mandatory properties.</li>
</ul>
<pre><code class="language-properties">	<span class="hljs-attr">spring.application.name</span>=<span class="hljs-string">b6-naming-service</span>

	<span class="hljs-attr">server.port</span>=<span class="hljs-string">8761</span>
<span class="hljs-comment">
	# Eureka : start</span>
<span class="hljs-comment">
	# Indicates whether or not this instance should register its information with eureka server for discovery by others.</span>
	<span class="hljs-attr">eureka.client.register-with-eureka</span>=<span class="hljs-string">false</span>
<span class="hljs-comment">
	# Indicates whether this client should fetch eureka registry information from eureka server.</span>
	<span class="hljs-attr">eureka.client.fetch-registry</span>=<span class="hljs-string">false</span>
<span class="hljs-comment">
	# when guessing a hostname, the IP address of the server should be used in preference to the hostname reported by the OS</span>
<span class="hljs-comment">	# eureka.instance.prefer-ip-address=true</span>
<span class="hljs-comment">
	# The hostname if it can be determined at configuration time (otherwise it will be guessed from OS primitives).</span>
<span class="hljs-comment">	# eureka.instance.hostname=localhost</span>
<span class="hljs-comment">
	# Eureka : end</span>
</code></pre>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="6-eureka-naming-server-client-configuration">6. Eureka Naming server client configuration</h2>
<h3 id="project-ref-b3-currency-exchange-service--b5-currency-conversion-service-openfeign">Project ref: <em>b3-currency-exchange-service</em> &amp; <em>b5-currency-conversion-service-openfeign</em></h3>
<ul>
<li>
<p><strong><ins>Purpose / Feature</ins></strong></p>
<ul>
<li>Register's the micro-service to Name server.</li>
</ul>
</li>
<li>
<p><strong><ins>Steps</ins></strong></p>
<ul>
<li><em><strong>Step-1:</strong></em> Add Eureka client in POM.xml</li>
<li><em><strong>Step-2:</strong></em> Configure eureka server URI in application.properties</li>
</ul>
</li>
<li>
<p><strong><ins>Maven / External dependency</ins></strong></p>
<ul>
<li>Required dependency.<pre><code class="language-xml">	<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-netflix-eureka-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong><ins>Config changes</ins></strong></p>
<ul>
<li><strong>Application Config:</strong> <em>application.properties</em><pre><code class="language-properties"><span class="hljs-comment">	# Start: Eureka client config</span>
<span class="hljs-comment">
	# Map of availability zone to list of fully qualified URLs to communicate with eureka server. </span>
<span class="hljs-comment">	# Each value can be a single URL or a comma separated list of alternative locations. </span>
<span class="hljs-comment">	# Typically the eureka server URLs carry protocol,host,port,context and version information if any. </span>
<span class="hljs-comment">	# Example: https://ec2-256-156-243-129.compute-1.amazonaws.com:7001/eureka/ </span>
	<span class="hljs-attr">eureka.client.service-url.defaultZone</span>=<span class="hljs-string">http://localhost:8761/eureka</span>
<span class="hljs-comment">
	# End: Eureka client config</span>
</code></pre>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>Note: If <code>Eureka client</code> dependency is present in <code>POM.xml</code>, spring will automatically try to register this service to Naming server by looking for <code>Eureka Server</code> on it's default <code>Eureka port - 8761</code>.</p>
</blockquote>
<hr>
<h2 id="7-load-balancing-microservices">7. Load Balancing microservices</h2>
<h3 id="project-ref-b3-currency-exchange-service--b5-currency-conversion-service-openfeign-1">Project ref: <em>b3-currency-exchange-service</em> &amp; <em>b5-currency-conversion-service-openfeign</em></h3>
<ul>
<li><strong><ins>Purpose / Feature</ins></strong>
<ul>
<li>Balance the traffic to the services dynamically by checking the current running instances.</li>
</ul>
</li>
<li><strong><ins>Steps</ins></strong>
<ul>
<li><em><strong>Step-1:</strong></em> Update the feign client <em><strong>@FeignClient</strong></em> <code>annotation</code></li>
<li><em><strong>Step-2:</strong></em> Note: Expections is that eureka client is already configed if not configure it first.</li>
<li><em><strong>Step-2:</strong></em> Also verify in eureka server that your micro-service is getting regitered.</li>
</ul>
</li>
<li><strong><ins>Code / Config changes</ins></strong>
<ul>
<li><strong>Feign Client:</strong> <em>AbcController.java</em>
<ul>
<li>imports
<ul>
<li><code>import org.springframework.cloud.openfeign.FeignClient;</code></li>
</ul>
</li>
<li>Annotate <code>@FeignClient</code> with only service name.</li>
</ul>
<pre><code class="language-java">	<span class="hljs-comment">//@FeignClient(name = &quot;b3-currency-exchange-service&quot;, url = &quot;localhost:8000&quot;)</span>
	<span class="hljs-comment">/* Find service details from name server using service name. */</span>
	<span class="hljs-meta">@FeignClient(name = &quot;b3-currency-exchange-service&quot;)</span> 
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CurrencyExchangeProxy</span> {

		<span class="hljs-comment">/**
		* Method as defined in the host service.
		* 
		* <span class="hljs-doctag">@param</span> from
		* <span class="hljs-doctag">@param</span> to
		* <span class="hljs-doctag">@return</span>
		*/</span>
		<span class="hljs-meta">@GetMapping(&quot;/jpa/currency-exchange/from/{from}/to/{to}&quot;)</span>
		<span class="hljs-keyword">public</span> CurrencyConversion <span class="hljs-title function_">retrieveExchangeRateFromDatabase</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String from, <span class="hljs-meta">@PathVariable</span> String to)</span>;
	}
</code></pre>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>Note: With service name it finds the server details from <code>Eureka Server</code>.</p>
</blockquote>
<hr>

            
            
        </body>
        </html>